

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tpages SVN Mysql Backup Plan &mdash; JustLive  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="JustLive  documentation" href="../../index.html"/>
        <link rel="up" title="Reports and Plans" href="index.html"/>
        <link rel="next" title="Programming Languages" href="../languages/index.html"/>
        <link rel="prev" title="Reports and Plans" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> JustLive
          

          
            
            <img src="../../_static/logo.png" class="logo" />
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../profile/index.html">Profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../life/index.html">Life</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Professionalism</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../knowledge/index.html">Point of Knowledge</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Reports and Plans</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Tpages SVN Mysql Backup Plan</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#local-servers">1. Local Servers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ali-cloud-servers">2. Ali Cloud Servers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#append-i-svn-sync-script">Append I: SVN Sync Script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#append-ii-data-backup-scrip">Append II: Data Backup Scrip</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../languages/index.html">Programming Languages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/index.html">Projects</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">JustLive</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Professionalism</a> &raquo;</li>
      
          <li><a href="index.html">Reports and Plans</a> &raquo;</li>
      
    <li>Tpages SVN Mysql Backup Plan</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/profession/reports/backup.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tpages-svn-mysql-backup-plan">
<h1><a class="toc-backref" href="#id1">Tpages SVN Mysql Backup Plan</a><a class="headerlink" href="#tpages-svn-mysql-backup-plan" title="Permalink to this headline">#</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#tpages-svn-mysql-backup-plan" id="id1">Tpages SVN Mysql Backup Plan</a><ul>
<li><a class="reference internal" href="#local-servers" id="id2">1. Local Servers</a><ul>
<li><a class="reference internal" href="#operation-system" id="id3">1.1 Operation System</a></li>
<li><a class="reference internal" href="#visual-svn-server" id="id4">1.2 Visual SVN Server</a><ul>
<li><a class="reference internal" href="#svn-backup" id="id5">1.2.1 SVN Backup</a></li>
<li><a class="reference internal" href="#svn-restore" id="id6">1.2.1 SVN Restore</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mysql-server" id="id7">1.3 Mysql Server</a><ul>
<li><a class="reference internal" href="#mysql-backup" id="id8">1.3.1 Mysql Backup</a></li>
<li><a class="reference internal" href="#mysql-restore" id="id9">1.3.2 Mysql Restore</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#ali-cloud-servers" id="id10">2. Ali Cloud Servers</a></li>
<li><a class="reference internal" href="#append-i-svn-sync-script" id="id11">Append I: SVN Sync Script</a></li>
<li><a class="reference internal" href="#append-ii-data-backup-scrip" id="id12">Append II: Data Backup Scrip</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="local-servers">
<h2><a class="toc-backref" href="#id2">1. Local Servers</a><a class="headerlink" href="#local-servers" title="Permalink to this headline">#</a></h2>
<div class="section" id="operation-system">
<h3><a class="toc-backref" href="#id3">1.1 Operation System</a><a class="headerlink" href="#operation-system" title="Permalink to this headline">#</a></h3>
<blockquote>
<div><strong>Windows Server 2008</strong></div></blockquote>
<p>For ITSERVER (192.168.3.17) with Windows Server 2008 installed, a three disk raid 1 (image) is created with hardware raid. Two disks are images of the other main drive. So, if one hard drive has error, technically you just need kick off the error disk in raid settings, and then OS will boot as normal.</p>
<blockquote>
<div><strong>Mac OSX</strong></div></blockquote>
<p>As for Mac OSX, we use its time machine to backup whole disk of Mac Server.</p>
</div>
<div class="section" id="visual-svn-server">
<h3><a class="toc-backref" href="#id4">1.2 Visual SVN Server</a><a class="headerlink" href="#visual-svn-server" title="Permalink to this headline">#</a></h3>
<div class="section" id="svn-backup">
<h4><a class="toc-backref" href="#id5">1.2.1 SVN Backup</a><a class="headerlink" href="#svn-backup" title="Permalink to this headline">#</a></h4>
<p>Here, we propose two ways for backing up the Visual SVN Server on ITSERVER(192.168.3.15), svnsync, for real time migration, and data backup (hotcopy), for plan B.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">underline:</th><td class="field-body"><cite>SVN SYNC</cite></td>
</tr>
</tbody>
</table>
<p>As depicted from the topology diagram above, SVN data on ITSERVER is synchronized through svn sync process to backup Server (SinoSpirit, 192.168.3.17) directory /Usres/geek/svnimage, which was implemented by deploying NRPE (Nagios Remote Plugin Executor) and executing one command (check_svn_sync) on backup server (SinoSpirit, 192.168.3.17). The destination directory is then published by Apache server. This synchronization process is repeated every 5 minutes as defined in Nagios Server (192.168.3.251) configuration file (templates.cfg).  SVN Synchronization Status and each repository’s newest revision are shown on Nagios Web UI (<a class="reference external" href="http://192.168.3.251">http://192.168.3.251</a>).</p>
<dl class="docutils">
<dt>Three steps must be done to realize svn sync backup.</dt>
<dd><ul class="first last simple">
<li>Create a repository that has the same name with the one in Visual SVN Server</li>
<li>Init the repository from the source repository</li>
<li>Start svn sync process</li>
</ul>
</dd>
</dl>
<p>Here, we wrote a shell script to create and synchronize all repositories. Simple commands like “sh svn_sync.sh –create” and “ sh svn_sync.sh –sync” can help implement the processes. Code can be checked in Append I.</p>
<blockquote>
<div><strong>SVN Data Backup</strong></div></blockquote>
<p>As for plan B, we backup svn data to a removable drive by svn hotcopy mechanism twice a day (every 13:30 PM and 23:00 PM). This is done by scheduling a job on ITSERVER (192.168.3.15). The batch code is placed in “D:scriptbackup.bat” directory and also can be checked in Append II.</p>
</div>
<div class="section" id="svn-restore">
<h4><a class="toc-backref" href="#id6">1.2.1 SVN Restore</a><a class="headerlink" href="#svn-restore" title="Permalink to this headline">#</a></h4>
<p>In case that ITSERVER can’t boot up, we set up two plans to restore the svn server in accordance with our backup plans.</p>
<blockquote>
<div><strong>SVN Migrate</strong></div></blockquote>
<p>Since we have a nearly real time backup of Visual SVN Server, we just need to change the backup server’s IP address (SinoSpirit, 192.168.3.17) to 192.168.3.15 and relocate your repository url to the new url in your tortoise client. However, two situations must be considered before relocating the url.</p>
<blockquote>
<div><ul class="simple">
<li>If revision on local workplace matches the revision on backup svn server, just change the svn server’s uuid to local workspace’s by typing the command.</li>
</ul>
<div class="highlight-shell"><div class="highlight"><pre><span></span>svnadmin setuuid /Users/geek/svnimage/repository_name <span class="o">[</span>New_UUID<span class="o">]</span>
</pre></div>
</div>
<ul class="simple">
<li>If revision on local workplace is ahead of the one on backup svn server, no other way but to check out from the new svn server and replace the files with those in your own workplace.</li>
</ul>
</div></blockquote>
<p>The above migration steps are in the premise that apache server can successfully publish our svn directory. In not, we should relocate or check out the repository with the following address in your tortoise client.
.. code-block:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Svn</span><span class="o">+</span><span class="n">ssh</span><span class="p">:</span><span class="o">//</span><span class="n">geek</span><span class="nd">@192</span><span class="o">.</span><span class="mf">168.3</span><span class="o">.</span><span class="mi">15</span><span class="p">:</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">geek</span><span class="o">/</span><span class="n">svnimage</span><span class="o">/</span><span class="n">repository_name</span>
</pre></div>
</div>
<p>, and enter geek’s password (many times).</p>
<p>Technically, the above processes can be done in less than 30 minutes.</p>
<blockquote>
<div><strong>SVN Data Restore</strong></div></blockquote>
<p>As for plan B, we can restore the svn on backup server from svn hotcopy data. Just place the backup svn data in geek’s Desktop, and restore the svn by executing the command “sh /Users/geek/script/svn_sync.sh –restore”. The script codes can be checked in Append I.</p>
<p>After restoring the data, follow the instructions above to finish the restore process. This plan will take up a little more 30 minutes.</p>
</div>
</div>
<div class="section" id="mysql-server">
<h3><a class="toc-backref" href="#id7">1.3 Mysql Server</a><a class="headerlink" href="#mysql-server" title="Permalink to this headline">#</a></h3>
<div class="section" id="mysql-backup">
<h4><a class="toc-backref" href="#id8">1.3.1 Mysql Backup</a><a class="headerlink" href="#mysql-backup" title="Permalink to this headline">#</a></h4>
<p>Same with SVN backup, we come with two methods to backup the Mysql server, mysql replication and mysql data backup.</p>
<p>The above diagram shows the two methods we use to backup the mysql server. First, we take advantage of mysql replication mechanism to synchronize any changes happened on ITSERVER Mysql Server to SinoSpirit Mysql Server. Second, we dump all databases on ITSERVER Mysql Server to a removable drive every 13:30PM and 23:00PM. The Mysqld Process Status on both servers and Slave Replication Status are monitored and shown on Nagios Web UI.</p>
<blockquote>
<div><strong>Mysql Replication</strong></div></blockquote>
<p>To realize mysql replication, we must have the same version of mysql server on both servers. In our environment, mysql version 5.6.26 is installed on both sides. We set ITSERVER (192.168.3.15) as mysql master and SinoSpirit (192.168.3.17) as myslq slave. The detailed steps are included:
1. Master Side (ITSERVER, 192.168.3.15)
Add “server-id=15” and “log-bin=mysql-bin” to my.cnf and restart the mysql daemon
Login mysql console with user root and type,
.. code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Mysql &gt; Grant replication slave on *.* to “sync”@”192.168.3.15” identified by ‘*6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9’ with grant option;
Mysql &gt; Flush privileges;
Mysql &gt; Show master status;
</pre></div>
</div>
<p>Remember the File and Position values in master status output.</p>
<ol class="arabic simple" start="2">
<li>Slave Side (SinoSpirit, 192.168.3.17)</li>
</ol>
<p>Add “server-id=17” and “bin-log=mysql-bin” to my.cnf and restart mysqld daemon. Login mysql console with user root and type.
.. code-block:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Mysql &gt; change master to
        Master_host=’192.168.3.15’,
        Master_user=’sync’,
        Master_password=’123456’,
        Master_log_file=’XXX’      ### File value shown on master status output
        Master_log_pos=’XXX’;      ### Position value shown on master status output
Mysql &gt; start slave;
Mysql &gt; show slave status\G;
</pre></div>
</div>
<p>When Slave_IO_Running and Slave_SQL_Running output of slave status are both “Yes”, the mysql server master –slave replication are made successfully. And status “OK” will be shown on Nagiso Web UI.</p>
<blockquote>
<div><strong>Mysql Data Backup</strong></div></blockquote>
<p>Mysql Data Backup Scheme is planned in case of mysql replication not working correctly. We schedule a job on ITSERVER to dump all databases to removable device. The job is executed at 13:30PM and 23:00PM every day. Batch script is placed in D:scriptbackup.bat and shown in Append II.</p>
</div>
<div class="section" id="mysql-restore">
<h4><a class="toc-backref" href="#id9">1.3.2 Mysql Restore</a><a class="headerlink" href="#mysql-restore" title="Permalink to this headline">#</a></h4>
<p>When ITSERVER cannot boot up, we can just change the IP address of backup mysql server (SinoSpirit, 192.168.3.17) to 192.168.3.15 and restart mysqld daemon. This can realize quick migration of mysql server, which definitely will not waste much of developers’ time.</p>
<p>If the above does not work, we can also restore the mysql data by source the dump file. However, it may take dozens of minutes to finish the task. So you’d better take some coffee and read materials other than this one.</p>
</div>
</div>
</div>
<div class="section" id="ali-cloud-servers">
<h2><a class="toc-backref" href="#id10">2. Ali Cloud Servers</a><a class="headerlink" href="#ali-cloud-servers" title="Permalink to this headline">#</a></h2>
</div>
<div class="section" id="append-i-svn-sync-script">
<h2><a class="toc-backref" href="#id11">Append I: SVN Sync Script</a><a class="headerlink" href="#append-i-svn-sync-script" title="Permalink to this headline">#</a></h2>
<div class="highlight-shell"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="nv">svn_base</span><span class="o">=</span><span class="s2">&quot;/Users/geek/svnimage/&quot;</span>
repos<span class="o">[</span>1<span class="o">]=</span><span class="s2">&quot;Documentation&quot;</span>
repos<span class="o">[</span>2<span class="o">]=</span><span class="s2">&quot;ECMall_Original&quot;</span>
repos<span class="o">[</span>3<span class="o">]=</span><span class="s2">&quot;go1978&quot;</span>
repos<span class="o">[</span>4<span class="o">]=</span><span class="s2">&quot;Jenkins&quot;</span>
repos<span class="o">[</span>5<span class="o">]=</span><span class="s2">&quot;Library&quot;</span>
repos<span class="o">[</span>6<span class="o">]=</span><span class="s2">&quot;Personal&quot;</span>
repos<span class="o">[</span>7<span class="o">]=</span><span class="s2">&quot;PigCMS&quot;</span>
repos<span class="o">[</span>8<span class="o">]=</span><span class="s2">&quot;PigCMS-Original&quot;</span>
repos<span class="o">[</span>9<span class="o">]=</span><span class="s2">&quot;Tpages&quot;</span>
repos<span class="o">[</span>10<span class="o">]=</span><span class="s2">&quot;Tpages.bak&quot;</span>
repos<span class="o">[</span>11<span class="o">]=</span><span class="s2">&quot;TpagesV3&quot;</span>
repos<span class="o">[</span>12<span class="o">]=</span><span class="s2">&quot;Trials&quot;</span>
<span class="nv">repos_num</span><span class="o">=</span>12

<span class="k">function</span> create_svnimage<span class="o">()</span> <span class="o">{</span>
        <span class="k">for</span> i in <span class="sb">`</span>seq <span class="nv">$repos_num</span><span class="sb">`</span><span class="p">;</span> <span class="k">do</span>
                /usr/bin/svnadmin create <span class="si">${</span><span class="nv">svn_base</span><span class="si">}${</span><span class="nv">repos</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span>
                cat <span class="si">${</span><span class="nv">svn_base</span><span class="si">}${</span><span class="nv">repos</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span>/hooks/pre-revprop-change.tmpl <span class="p">|</span> /usr/bin/sed <span class="s1">&#39;s/^exit 1$/exit 0/&#39;</span> &gt; <span class="si">${</span><span class="nv">svn_base</span><span class="si">}${</span><span class="nv">repos</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span>/hooks/pre-revprop-change
                chmod <span class="m">755</span> <span class="si">${</span><span class="nv">svn_base</span><span class="si">}${</span><span class="nv">repos</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span>/hooks/pre-revprop-change
                /usr/bin/svnsync init --sync-username<span class="o">=</span>sync --sync-password<span class="o">=</span><span class="m">123456</span> file:///Users/geek/svnimage/<span class="si">${</span><span class="nv">repos</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span> https://192.168.3.15/svn/<span class="si">${</span><span class="nv">repos</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span> &gt; /dev/null 2&gt;<span class="p">&amp;</span>1
                /usr/bin/svnsync sync file:///Users/geek/svnimage/<span class="si">${</span><span class="nv">repos</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span> &gt; /dev/null 2&gt;<span class="p">&amp;</span>1
                <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
                        /bin/echo <span class="s2">&quot;[** Info] Repository </span><span class="si">${</span><span class="nv">repos</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span><span class="s2"> Created Successfully.&quot;</span>
                <span class="k">else</span>
                        /bin/echo <span class="s2">&quot;[** Error] Repository </span><span class="si">${</span><span class="nv">repos</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span><span class="s2"> Created Failed.&quot;</span>
                        <span class="nb">exit</span> 1
                <span class="k">fi</span>
        <span class="k">done</span>
        <span class="nb">exit</span> 0
<span class="o">}</span>


<span class="k">function</span> sync_svn<span class="o">()</span> <span class="o">{</span>
        <span class="nv">time</span><span class="o">=</span><span class="sb">`</span>/bin/date <span class="s2">&quot;+%y/%m/%d-%H:%M:%S&quot;</span><span class="sb">`</span>
        /bin/ls -l <span class="si">${</span><span class="nv">svn_base</span><span class="si">}</span> <span class="p">|</span> /usr/bin/grep -v <span class="s2">&quot;total&quot;</span> <span class="p">|</span> /usr/bin/awk <span class="s1">&#39;{print $9}&#39;</span> <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> line
        <span class="k">do</span>
                <span class="nv">svn_repo</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="si">${</span><span class="nv">svn_base</span><span class="si">}${</span><span class="nv">line</span><span class="si">}</span><span class="sb">`</span>
                /usr/bin/svnsync sync file://<span class="si">${</span><span class="nv">svn_repo</span><span class="si">}</span> &gt; /dev/null 2&gt;<span class="p">&amp;</span>1
                <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
                        /bin/echo <span class="s2">&quot;[** Error] Subversion Synchronization Failed At </span><span class="si">${</span><span class="nv">time</span><span class="si">}</span><span class="s2">.&quot;</span>
                        <span class="nb">exit</span> 1
                <span class="k">else</span>
                        <span class="k">continue</span>
                <span class="k">fi</span>
        <span class="k">done</span>
<span class="c1">#       /bin/echo &quot;[** Info] Subversion Synchronization Succeed At ${time}.&quot;</span>
        <span class="nb">exit</span> 0
<span class="o">}</span>


<span class="k">function</span> restore_data<span class="o">()</span> <span class="o">{</span>
        <span class="nb">cd</span> /Users/geek/Desktop
        /bin/ls -l /Users/geek/Desktop/*.7z <span class="p">|</span> /usr/bin/awk <span class="s1">&#39;{print $9}&#39;</span> <span class="p">|</span><span class="k">while</span> <span class="nb">read</span> line
        <span class="k">do</span>
                7za x <span class="nv">$line</span> &gt; /dev/null 2&gt;<span class="p">&amp;</span>1
        <span class="k">done</span>
        /bin/ls -l /Users/geek/Desktop <span class="p">|</span> /usr/bin/grep -v <span class="s2">&quot;\.7z&quot;</span> <span class="p">|</span> /usr/bin/grep -v <span class="s2">&quot;total&quot;</span> <span class="p">|</span> /usr/bin/awk <span class="s1">&#39;{print $9}&#39;</span> <span class="p">|</span><span class="k">while</span> <span class="nb">read</span> line
        <span class="k">do</span>
                /usr/bin/svnadmin hotcopy /Users/geek/Desktop/<span class="nv">$line</span> /Users/geek/svnimage/<span class="nv">$line</span> &gt; /dev/null 2&gt;<span class="p">&amp;</span>1
                <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
                        /bin/echo <span class="s2">&quot;[** Info] Repository </span><span class="nv">$line</span><span class="s2"> Restored Successfully.&quot;</span>
                <span class="k">else</span>
                        /bin/echo <span class="s2">&quot;[** Error] Repository </span><span class="nv">$line</span><span class="s2"> Restored Failed.&quot;</span>
                <span class="k">fi</span>
        <span class="k">done</span>
<span class="o">}</span>


<span class="c1"># Usage Information</span>
<span class="k">function</span> usage<span class="o">()</span> <span class="o">{</span>
        <span class="k">case</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> in
                <span class="s2">&quot;--create&quot;</span><span class="o">)</span>
                        create_svnimage
        <span class="p">;;</span>
                <span class="s2">&quot;--sync&quot;</span><span class="o">)</span>
                        sync_svn
        <span class="p">;;</span>
                <span class="s2">&quot;--restore&quot;</span><span class="o">)</span>
                restore_data
<span class="k">esac</span>
<span class="o">}</span>


<span class="c1"># Main Entry</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$#</span> -eq <span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nv">$1</span> <span class="o">=</span>~ <span class="o">(</span>^--create$<span class="p">|</span>^--sync$<span class="p">|</span>^--restore$<span class="o">)</span> <span class="o">]]</span>
        <span class="k">then</span>
                usage <span class="nv">$1</span>
        <span class="k">else</span>
                <span class="nb">echo</span> <span class="s2">&quot;Wrong Option. You need to specify a qualified option: （only one for each option)</span>
<span class="s2">List of options:</span>
<span class="s2">--create        create svnimage in directory /Users/geek/svnimage on local server.</span>
<span class="s2">--sync          Synchronize from Visual SVN Server on 192.168.3.15.</span>
<span class="s2">--restore       Restore the svn from svn backup data (Make sure all 7zip backup file are stored on Desktop).&quot;</span>
        <span class="nb">exit</span> 1
<span class="k">fi</span>
</pre></div>
</div>
</div>
<div class="section" id="append-ii-data-backup-scrip">
<h2><a class="toc-backref" href="#id12">Append II: Data Backup Scrip</a><a class="headerlink" href="#append-ii-data-backup-scrip" title="Permalink to this headline">#</a></h2>
<div class="highlight-batch"><div class="highlight"><pre><span></span><span class="p">:</span><span class="c1">: Begin of Backup Batch File (D:\scripts\)</span>

<span class="p">@</span><span class="k">ECHO</span> OFF

<span class="p">:</span><span class="c1">: Command Directory</span>
<span class="k">SET</span> <span class="nv">mysqldir</span><span class="p">=</span><span class="s2">&quot;D:\Program Files\MySQL\MySQL Server 5.6&quot;</span>
<span class="k">SET</span> <span class="nv">svndir</span><span class="p">=</span><span class="s2">&quot;C:\Program Files\VisualSVN Server&quot;</span>
<span class="k">SET</span> <span class="nv">zipdir</span><span class="p">=</span><span class="s2">&quot;C:\Program Files\7-Zip&quot;</span>

<span class="p">:</span><span class="c1">: Backup Info</span>
<span class="k">SET</span> <span class="nv">backtime</span><span class="p">=</span><span class="nv">%date%</span>-<span class="nv">%time:~0,2%</span>-<span class="nv">%time:~3,2%</span>
<span class="k">SET</span> <span class="nv">dbuser</span><span class="p">=</span>root
<span class="k">SET</span> <span class="nv">dbpasswd</span><span class="p">=</span>123456
<span class="k">SET</span> <span class="nv">mysql_backup_dir</span><span class="p">=</span>D:\mysql_data_bak
<span class="k">if</span> <span class="k">not</span> <span class="k">exist</span> <span class="nv">%mysql_backup_dir%</span> <span class="k">md</span> <span class="nv">%mysql_backup_dir%</span>
<span class="k">SET</span> <span class="nv">svn_backup_dir</span><span class="p">=</span>D:\svn_data_bak
<span class="k">if</span> <span class="k">not</span> <span class="k">exist</span> <span class="nv">%svn_backup_dir%</span> <span class="k">md</span> <span class="nv">%svn_backup_dir%</span>

<span class="p">:</span><span class="c1">: SVN Data Backup</span>
<span class="k">SET</span> <span class="nv">LOG_FILE</span><span class="p">=</span><span class="nv">%TEMP%</span>.\svn_back.log
<span class="k">SET</span> <span class="nv">ZIP_LOG</span><span class="p">=</span><span class="nv">%TEMP%</span>.\svn_7z.log
<span class="k">dir</span> /b /ad D:\Repositories <span class="p">&gt;</span> <span class="nv">%LOG_FILE%</span>
<span class="k">for</span> <span class="k">/f</span> <span class="se">%%</span>i <span class="k">in</span> <span class="p">(</span><span class="nv">%LOG_FILE%</span><span class="p">)</span> <span class="k">do</span> <span class="p">(</span>
    <span class="nv">%svndir%</span>\bin\svnadmin hotcopy D:\Repositories\<span class="se">%%</span>i <span class="nv">%svn_backup_dir%</span>\<span class="se">%%</span>i  <span class="mi">1</span><span class="p">&gt;</span> nul
    <span class="p">)</span>
<span class="nv">%zipdir%</span>\7z.exe a -t7z D:\Backup\subversion-<span class="nv">%backtime%</span>.7z <span class="nv">%svn_backup_dir%</span>\ <span class="mi">1</span><span class="p">&gt;</span> nul
<span class="k">rd</span> /s/q <span class="nv">%svn_backup_dir%</span>



<span class="p">:</span><span class="c1">: Mysql Data Backup</span>
<span class="k">cd</span> <span class="nv">%mysql_backup_dir%</span>
<span class="nv">%mysqldir%</span>\bin\mysqldump -u <span class="nv">%dbuser%</span> -p<span class="nv">%dbpasswd%</span> --default-character-set=utf8 --opt --all-databases <span class="p">&gt;</span> <span class="nv">%mysql_backup_dir%</span>\all-<span class="nv">%backtime%</span>.sql <span class="mi">1</span><span class="p">&gt;</span> nul
<span class="k">cd</span> D:\Backup
<span class="nv">%zipdir%</span>\7z.exe a -t7z D:\Backup\mysql-<span class="nv">%backtime%</span>.7z <span class="nv">%mysql_backup_dir%</span>\ <span class="mi">1</span><span class="p">&gt;</span> nul
<span class="k">rd</span> /s/q <span class="nv">%mysql_backup_dir%</span>

<span class="p">:</span><span class="c1">: End of Backup Batch File</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../languages/index.html" class="btn btn-neutral float-right" title="Programming Languages" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Reports and Plans" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Leon Lee &lt;lee.leon0519@gmail.com&gt;.
      Last updated on Dec 16, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>