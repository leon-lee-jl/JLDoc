

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TPages Certificate Infrastructure (TCI) &mdash; JustLive  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="JustLive  documentation" href="../index.html"/>
        <link rel="up" title="Projects" href="index.html"/>
        <link rel="next" title="TPages Common Info (TCI)" href="common.html"/>
        <link rel="prev" title="TPages Buggit" href="buggit.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> JustLive
          

          
            
            <img src="../_static/logo.png" class="logo" />
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../profile/index.html">Profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../life/index.html">Life</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profession/index.html">Professionalism</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Projects</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="buggit.html">TPages Buggit</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">TPages Certificate Infrastructure (TCI)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#file-notes"><strong>File Notes</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-line"><strong>Command Line</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#establish-ca"><strong><em>Establish CA</em></strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#generate-server-certificates"><strong><em>Generate Server Certificates</em></strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#generate-personal-certificates"><strong><em>Generate Personal Certificates</em></strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-certificate-format"><strong><em>Change Certificate Format</em></strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#generate-public-key-from-private-key"><strong><em>Generate Public Key from Private Key</em></strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-cert-authority-to-system-nssdb"><strong><em>Add Cert Authority to System NSSDB</em></strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#todo"><strong>TODO</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="common.html">TPages Common Info (TCI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="dockers.html">Tpages Dockers Deployment (TDD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="pytp.html">wechatrobot</a></li>
<li class="toctree-l2"><a class="reference internal" href="saltstack.html">TPages Automation Management (TAM)</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">JustLive</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Projects</a> &raquo;</li>
      
    <li>TPages Certificate Infrastructure (TCI)</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/projects/certificates.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tpages-certificate-infrastructure-tci">
<span id="tpages-certificate-infrastructure-tci"></span><h1>TPages Certificate Infrastructure (TCI)<a class="headerlink" href="#tpages-certificate-infrastructure-tci" title="Permalink to this headline">#</a></h1>
<p><img src="../_static/tp-certificates-logo.jpg" width="500" height="110" alt="Script_Options"/></p>
<p>This repository stores the RSA based public key (certificate) and private key pairs which are used for website secure access (https), server ssh login, vpn authentication, and so on. Also, it aims at building private certificates and making the building process more easily.</p>
<div class="section" id="table-of-contents">
<span id="table-of-contents"></span><h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><a class="reference external" href="#file-notes"><strong>File Notes</strong></a></li>
<li><a class="reference external" href="#command-line"><strong>Command Line</strong></a><ul>
<li><a class="reference external" href="#establish-ca"><strong><em>Establish CA</em></strong></a></li>
<li><a class="reference external" href="#generate-server-certificates"><strong><em>Generate Server Certificates</em></strong></a></li>
<li><a class="reference external" href="#generate-personal-certificates"><strong><em>Generate Personal Certificates</em></strong></a></li>
<li><a class="reference external" href="#change-certificate-format"><strong><em>Change Certificate Format</em></strong></a></li>
<li><a class="reference external" href="#generate-public-key-from-private-key"><strong><em>Generate Public Key from Private Key</em></strong></a></li>
<li><a class="reference external" href="#add-cert-authority-to-system-nssdb"><strong><em>Add Cert Authority to System NSSDB</em></strong></a></li>
</ul>
</li>
<li><a class="reference external" href="#todo"><strong>TODO</strong></a></li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="file-notes">
<span id="file-notes"></span><h2><strong>File Notes</strong><a class="headerlink" href="#file-notes" title="Permalink to this headline">#</a></h2>
<p>Five directories are contained in this repo, within which consists of certificates for different usage.</p>
<!--table-->
| Directory   | Files           |Notes  |
| --------    | -----            | ------    |
| ca          | CA cert & key pairs  | Local self-signed root ca     |
| server      | Itserver (192.168.3.17) and singapore dev server (47.88.151.151) cert & key pairs  | Tpages dev servers cert & key singed by local ca    |
| Godaddy     | GoDaddy cert authority in case that you want to add godaddy authority certs to system cert center, cert and key pairs for tpages.cn and *.tpages.cn  | Premium certificates signed by Godaddy   |
| production  | Tpages merchant key pairs in production | Used for 3rd party payment, including alipay, wechat pay, and wechat app pay  |
| Personal    | Certs and key paris of Leon, JC, Jerry, nginx, loggie | Used for alicloud server ssh/sftp login, pptp vpn authentication|
<!--endtable--></div>
<hr class="docutils" />
<div class="section" id="command-line">
<span id="command-line"></span><h2><strong>Command Line</strong><a class="headerlink" href="#command-line" title="Permalink to this headline">#</a></h2>
<p>To make a private certificate, you should have openssl installed on your server. Details of the installation process will not be covered here.</p>
<div class="section" id="establish-ca">
<span id="establish-ca"></span><h3><strong><em>Establish CA</em></strong><a class="headerlink" href="#establish-ca" title="Permalink to this headline">#</a></h3>
<p>The CA is a also a pair of public and private key. The difference is the key pair is used for nothing but to sigh and verify the validity of a certificate.</p>
<p>Tpages CA is generated on request of the following information:</p>
<blockquote>
<div><ul class="simple">
<li>Country Name: CN</li>
<li>State or Province Name: GD</li>
<li>Locality Name: GZ</li>
<li>Organization Name: Tianao Internet Technology Limited</li>
<li>Organization Unit Name: Certificate Center</li>
<li>Common Name: tianao.com.hk</li>
<li>Email Address: admin&#64;tpages.com</li>
</ul>
</div></blockquote>
<p>with the following commands:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>mkdir ca <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ca
openssl genrsa -out cakey.pem 2048
openssl req -new -x509 -days <span class="m">3650</span> -key cakey.pem -out cacert.pem
</pre></div>
</div>
</div>
<div class="section" id="generate-server-certificates">
<span id="generate-server-certificates"></span><h3><strong><em>Generate Server Certificates</em></strong><a class="headerlink" href="#generate-server-certificates" title="Permalink to this headline">#</a></h3>
<p>The server certificates are used for secure http access to a website, and it&#8217;s usually stored in pem, cert or crt file format.</p>
<p>Tpages ITSERVER certificate is generated on request of the following information:</p>
<blockquote>
<div><ul class="simple">
<li>Country Name: CN</li>
<li>State or Province Name: GD</li>
<li>Locality Name: GZ</li>
<li>Organization Name: Tianao Internet Technology Limited</li>
<li>Organization Unit Name: Certificate Center</li>
<li>Common Name: 192.168.3.15</li>
<li>Email Address: admin&#64;tpages.com</li>
</ul>
</div></blockquote>
<p>with the following commands:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>mkdir servers <span class="o">&amp;&amp;</span> <span class="nb">cd</span> servers
openssl genrsa -out itserver.key 2048
openssl req -new -key itserver.key -out itserver.csr
openssl x509 -req -in itserver.csr -days <span class="m">3650</span>  -CA ../ca/cacert.pem -CAkey ../ca/cakey.pem -CAcreateserial -out itserver.pem
</pre></div>
</div>
<p>If you wish to generate a server certificate with domain name, just change the common name to the domain name. If you want to generate a certificate with multi subdomain names, also change the common name to the domain name with a wildcard ahead of it (such as *.tpages.cn).</p>
</div>
<div class="section" id="generate-personal-certificates">
<span id="generate-personal-certificates"></span><h3><strong><em>Generate Personal Certificates</em></strong><a class="headerlink" href="#generate-personal-certificates" title="Permalink to this headline">#</a></h3>
<p>The Personal certificates are the same like server certificates, but with different usage.</p>
<p>Here is a sample personal certificate request information:</p>
<blockquote>
<div><ul class="simple">
<li>Country Name: CN</li>
<li>State or Province Name: GD</li>
<li>Locality Name: GZ</li>
<li>Organization Name: Tianao Internet Technology Limited</li>
<li>Organization Unit Name: Certificate Center</li>
<li>Common Name: Leon</li>
<li>Email Address: leon&#64;tpages.com</li>
</ul>
</div></blockquote>
<p>with the following commands:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>mkdir personal <span class="o">&amp;&amp;</span> <span class="nb">cd</span> personal
openssl genrsa -out leon.key 2048
openssl req -new -key leon.key -out leon.csr
openssl x509 -req -in leon.csr -days <span class="m">3650</span>  -CA ../ca/cacert.pem -CAkey ../ca/cakey.pem -CAcreateserial -out leon.pem
</pre></div>
</div>
</div>
<div class="section" id="change-certificate-format">
<span id="change-certificate-format"></span><h3><strong><em>Change Certificate Format</em></strong><a class="headerlink" href="#change-certificate-format" title="Permalink to this headline">#</a></h3>
<div class="highlight-shell"><div class="highlight"><pre><span></span><span class="c1"># change certificate format to p12 (public and private key combined key combined)</span>
openssl pkcs12 -export -clcerts -in leon.pem -inkey leon.key -out leon.p12
</pre></div>
</div>
<ul class="simple">
<li><strong><em>Encrypt and Decrypt Key File</em></strong></li>
</ul>
<p>Since the key is quite important, we should keep the key protected. The following are commands to encrypt and decrypt key file with openssl.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>openssl enc -des -e -a -in leon.key -out leon.key.des  <span class="c1"># encrypt</span>
openssl enc -des -d -a -in leon.key.des -out leon.key  <span class="c1"># decrypt</span>
</pre></div>
</div>
<ul class="simple">
<li><strong><em>Add Passphase to Key</em></strong></li>
</ul>
<p>Also we can add a passphase to protect the key. To make it, you should install openssh first.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>ssh-keygen -p -f leon.key
</pre></div>
</div>
<p>Type the passphase when the console promote to you.</p>
</div>
<div class="section" id="generate-public-key-from-private-key">
<span id="generate-public-key-from-private-key"></span><h3><strong><em>Generate Public Key from Private Key</em></strong><a class="headerlink" href="#generate-public-key-from-private-key" title="Permalink to this headline">#</a></h3>
<p>A pulic key can be generated according to the private key in different formats.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span><span class="c1">#Generate ssh-like public key according to openssl generated private key</span>
ssh-keygen -f leon.key -y &gt; ~/.ssh/id_rsa.pub
<span class="c1">#Generate openssl public key according to its private key</span>
openssl rsa -in leon.key -pubout -out leon.pem
</pre></div>
</div>
</div>
<div class="section" id="add-cert-authority-to-system-nssdb">
<span id="add-cert-authority-to-system-nssdb"></span><h3><strong><em>Add Cert Authority to System NSSDB</em></strong><a class="headerlink" href="#add-cert-authority-to-system-nssdb" title="Permalink to this headline">#</a></h3>
<div class="highlight-shell"><div class="highlight"><pre><span></span><span class="c1"># Add Root Certificate Authority</span>
sudo certutil -d sql:/etc/pki/nssdb -A -t <span class="s2">&quot;C,,&quot;</span> -n GoDaddyRootCA -i GoDaddy_Root_Certificate_Authority.cer
<span class="c1"># Add Intermediate Certificate Authority</span>
sudo certutil -d sql:/etc/pki/nssdb -A -t <span class="s2">&quot;,,&quot;</span> -n GoDaddySecuretCA -i GoDaddy_Secure_Certificate_Authority.cer
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="todo">
<span id="todo"></span><h2><strong>TODO</strong><a class="headerlink" href="#todo" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li>[X] Customized certificates for tpages servers and staffs</li>
<li>[X] Enabled ssh certificate login and vpn login</li>
<li>[ ] Build handy certificate auto generate tools</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="common.html" class="btn btn-neutral float-right" title="TPages Common Info (TCI)" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="buggit.html" class="btn btn-neutral" title="TPages Buggit" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Leon Lee &lt;lee.leon0519@gmail.com&gt;.
      Last updated on Dec 15, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>