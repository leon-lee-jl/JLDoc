

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TPages Automation Management (TAM) &mdash; JustLive  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="JustLive  documentation" href="../index.html"/>
        <link rel="up" title="Projects" href="index.html"/>
        <link rel="prev" title="wechatrobot" href="pytp.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> JustLive
          

          
            
            <img src="../_static/logo.png" class="logo" />
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../profile/index.html">Profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../life/index.html">Life</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profession/index.html">Professionalism</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Projects</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="buggit.html">TPages Buggit</a></li>
<li class="toctree-l2"><a class="reference internal" href="certificates.html">TPages Certificate Infrastructure (TCI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html">TPages Common Info (TCI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="dockers.html">Tpages Dockers Deployment (TDD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="pytp.html">wechatrobot</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">TPages Automation Management (TAM)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#introduction"><strong>Introduction</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#architecture"><strong>Architecture</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#saltstack-key-components"><strong><em>SaltStack Key Components</em></strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#deployment-architecture"><strong><em>Deployment Architecture</em></strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#bootstrap"><strong><em>Bootstrap</em></strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installation"><strong>Installation</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#upgrading"><strong><em>Upgrading</em></strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-commands"><strong><em>Common Commands</em></strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#operating-steps"><strong>Operating Steps</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#features"><strong>Features</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#nodegroup"><strong><em>Nodegroup</em></strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#states"><strong><em>States</em></strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#pillar"><strong><em>Pillar</em></strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#grains"><strong><em>Grains</em></strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#trouble-shooting"><strong>Trouble Shooting</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#todo"><strong>TODO</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">JustLive</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Projects</a> &raquo;</li>
      
    <li>TPages Automation Management (TAM)</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/projects/saltstack.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tpages-automation-management-tam">
<span id="tpages-automation-management-tam"></span><h1>TPages Automation Management (TAM)<a class="headerlink" href="#tpages-automation-management-tam" title="Permalink to this headline">#</a></h1>
<p><img src="../_static/tp-saltstack-logo.jpg" width="500" height="110" alt="Script_Options"/></p>
<div class="section" id="table-of-contents">
<span id="table-of-contents"></span><h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><a class="reference external" href="#introduction"><strong>Introduction</strong></a></li>
<li><a class="reference external" href="#architecture"><strong>Architecture</strong></a><ul>
<li><a class="reference external" href="#saltstack-key-components"><strong><em>SaltStack Key Components</em></strong></a></li>
<li><a class="reference external" href="#deployment-architecture"><strong><em>Deployment Architecture</em></strong></a></li>
</ul>
</li>
<li><a class="reference external" href="#bootstrap"><strong>Bootstrap</strong></a><ul>
<li><a class="reference external" href="#installation"><strong><em>Installation</em></strong></a></li>
<li><a class="reference external" href="#upgrading"><strong><em>Upgrading</em></strong></a></li>
<li><a class="reference external" href="#common-commands"><strong><em>Common Commands</em></strong></a></li>
<li><a class="reference external" href="#operating-steps"><strong><em>Operating Steps</em></strong></a></li>
</ul>
</li>
<li><a class="reference external" href="#trouble-shooting"><strong>Trouble Shooting</strong></a></li>
<li><a class="reference external" href="#todo"><strong>TODO</strong></a></li>
</ul>
<!-- /MarkdownTOC -->
---------------------------------</div>
<div class="section" id="introduction">
<span id="introduction"></span><h2><strong>Introduction</strong><a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://docs.saltstack.com/en/latest/topics/releases/2016.3.0.html">SaltStack</a> is &#8220;an automation for enterprise IT ops, event-driven data center orchestration and the most flexible configuration management for DevOps at scale.&#8221; It use Jinja2 as its template engine so that all sls state file can be weritten in <a class="reference external" href="http://jinja.pocoo.org/docs/dev/templates/">jinja2 template desinging syntax</a>. The most important steps in deploying saltstack is the salt state file, which manages all the components and processes in operating servers. SaltStack assembles some basic state modules which are very useful when scripting the state file. The full list of builtin state modules can be found <a class="reference external" href="https://docs.saltstack.com/en/latest/ref/states/all">here</a>.</p>
<p>Our production deployment is based on saltstack version 2016.3.0. Installation and upgrading steps will be depited in the next chapter in detail.</p>
</div>
<hr class="docutils" />
<div class="section" id="architecture">
<span id="architecture"></span><h2><strong>Architecture</strong><a class="headerlink" href="#architecture" title="Permalink to this headline">#</a></h2>
<div class="section" id="saltstack-key-components">
<span id="saltstack-key-components"></span><h3><strong><em>SaltStack Key Components</em></strong><a class="headerlink" href="#saltstack-key-components" title="Permalink to this headline">#</a></h3>
<div  align="center">    
<img src="../_static/saltstack_components.png" alt="Script_Options" />
</div>
<div align="center"> <p><b>Fig.1 SaltStack Components</b></p> </div><blockquote>
<div><ul class="simple">
<li><strong>Salt Master</strong>: Management Center, opening local port 4505 and 4506 in default</li>
<li><strong>Salt Minion</strong>: Management client, fetching and executing commands from salt master</li>
<li><strong>Top file</strong>: Main management file for matching formulas and pillars to minions</li>
<li><strong>Formulas</strong>: A declarative or imperative representation of a system configuration.</li>
<li><strong>Pillars</strong>: Variables stored in master and assigned to minions</li>
<li><strong>Grains</strong>: Variables stored in minions and passed to master when retrieving</li>
<li><strong>Reactor</strong>: Trigger reactions when events occur in your SaltStack environment</li>
<li><strong>Salt SSH</strong>: Run Salt commands over SSH on systems that do not have a minions</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="deployment-architecture">
<span id="deployment-architecture"></span><h3><strong><em>Deployment Architecture</em></strong><a class="headerlink" href="#deployment-architecture" title="Permalink to this headline">#</a></h3>
<div  align="center">    
<img src="../_static/SaltStack_deployment_architecture.png" alt="Script_Options" />
</div>
<div align="center"> <p><b>Fig.1 SaltStack Deployment Architecture</b></p> </div><p>In our production environment, we divide all severs into three nodegroups, including alicloud-cn, alicloud-intl, and local (Also we can call them clusters to be in accordance with ganglia naming custom). Servers in local nodegroup can directly connect salt-master&#8217;s listening ports (4505 and 4506), while those in alicloud-cn and alicloud-intl nodegroups must indirectly connect to the master with the help of ssh remote tunnel, which forwards master&#8217;s opening ports (4505 and 4506) to specified minions (www.123go.net.cn and dev.tpages.intl). A ssh tunnel scripts is located in tool directory of this projects. Usages info is as follows:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span><span class="c1"># Start ssh remote tunnels</span>
sh saltmaster-tunnels.sh --start
<span class="c1"># Stop ssh remote tunnels</span>
sh saltmaster-tunnels.sh --stop
</pre></div>
</div>
<p>Through the ssh tunnel, servers on the clound can connect to minion www.123go.net.cn or dev.tpages.intl intranet address. The data to those two minions will then forwarded to master through data forwarding. To sum up, before applying state files or making changes to servers, remember start ssh tunnel and use &#8220;salt &#8216;*&#8216; test.ping&#8221; command to check connecting status of minions.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="bootstrap">
<span id="bootstrap"></span><h2><strong><em>Bootstrap</em></strong><a class="headerlink" href="#bootstrap" title="Permalink to this headline">#</a></h2>
<div class="section" id="installation">
<span id="installation"></span><h3><strong>Installation</strong><a class="headerlink" href="#installation" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><strong><em>Install Salt</em></strong></li>
</ul>
<p>Install SaltStack with the specified version on most of the systems, <strong>excluding OSX and Windows</strong>. For example, to install salt version 2015.8.8, we just type the following command.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>sudo sh src/tools/scripts/bootstrp_salt.sh git v2015.8.8
</pre></div>
</div>
<p>For OSX users, install saltstack with pip or homebrew on OSX is better choice, and make sure the version matches or be later than the one installed by bootstracp script.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>brew install python
pip install salt
</pre></div>
</div>
<ul class="simple">
<li><strong><em>Install other related dependencies</em></strong></li>
</ul>
<p>To check installation result and other uninstalled dependencies, type the following command:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>salt --versions-report
</pre></div>
</div>
<p>Then use pip to install those listed as &#8220;not installed&#8221;.</p>
<p>You should always be cautious on installing pygit2 and libgit2, since those two packages must be compatible, or in other words, versions must match. However, packages management tools can&#8217;t assure that. Here we suggest installing the two from source code with both in version 0.24.0, as it has been tested in production.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span><span class="c1"># Install libgit2</span>
git clone https://github.com/libgit2/libgit2.git -b v0.24.0
mkdir libgigt2/build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> libgit2/build <span class="o">||</span> <span class="k">return</span>
cmake .. <span class="o">&amp;&amp;</span> cmake --build . --target install
ln -s /usr/local/lib/libgit2.so.24 /lib/
<span class="nb">cd</span> ../../ <span class="o">&amp;&amp;</span> rm -fr libgit2/
<span class="c1"># Install pygit2</span>
git clone https://github.com/libgit2/pygit2.git -b v0.24.0
<span class="nb">cd</span> pygit2 <span class="o">||</span> <span class="k">return</span>
python setup.py install
<span class="nb">cd</span> ../ <span class="o">&amp;&amp;</span> rm -fr pygit2/
</pre></div>
</div>
<ul class="simple">
<li><strong><em>Install tools for local build</em></strong></li>
</ul>
<p>Our project conducts some local tests before applying the changes to production for safety reason. Those tests include shell syntax check, nginx config test, and state file check. Necessary tools are required to perform such tests. To install them, type the following commands.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span><span class="c1"># Install tools with system package management tool</span>
brew/yum/apt-get install ant shellcheck nginx autossh
</pre></div>
</div>
<ul class="simple">
<li><strong><em>Build the first stable distribution</em></strong></li>
</ul>
<p>Since our salt-master is run under &#8216;dist&#8217; directory of this project, we must  build the first stable release based on our stable src files (in src directory).</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>ant stable
</pre></div>
</div>
<ul class="simple">
<li><strong><em>Config salt</em></strong></li>
</ul>
<p>Add the following environment to your system, including master and minion if you wanna use your custom config directory</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">SALT_CONFIG_DIR</span><span class="o">=</span>/path/to/your/config/dir
</pre></div>
</div>
<p>Make a symbolic link of your custom config dir to system level directory.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>sudo ln -s /path/to/your/cofig/dir/* /etc/
</pre></div>
</div>
</div>
<div class="section" id="upgrading">
<span id="upgrading"></span><h3><strong><em>Upgrading</em></strong><a class="headerlink" href="#upgrading" title="Permalink to this headline">#</a></h3>
<p>When upgrading Salt, the master(s) should always be upgraded first. Backward compatibility for minions running newer versions of salt than their masters is not guaranteed.
If bootstrap script is used to install salt, you should also use the script to upgrade salt.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">sh</span> <span class="n">tools</span><span class="o">/</span><span class="n">bootstrap_salt</span><span class="o">.</span><span class="n">sh</span> <span class="n">git</span> <span class="n">v2016</span><span class="o">.</span><span class="mf">3.0</span>
</pre></div>
</div>
<p>When using pip to install salt, use the following command to upgrade.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">salt</span> <span class="o">--</span><span class="n">upgrade</span>
</pre></div>
</div>
<p>Ado also you can checkout salt source code directory in github, and install it form the source yourself.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>git clone https://github.com/saltstack/salt.git -b v2016.3.0
<span class="nb">cd</span> salt <span class="o">&amp;&amp;</span> sudo python setup.py install
</pre></div>
</div>
<p><strong><em>Remember: Always restart salt-master or salt-minions when you have made an upgrading on it.</em></strong></p>
</div>
<div class="section" id="common-commands">
<span id="common-commands"></span><h3><strong><em>Common Commands</em></strong><a class="headerlink" href="#common-commands" title="Permalink to this headline">#</a></h3>
<div class="highlight-shell"><div class="highlight"><pre><span></span><span class="c1"># Apply state XXX to all minions</span>
salt <span class="s1">&#39;*&#39;</span> state.apply XXX
<span class="c1"># Apply state XXX to specified minion, nodegroup</span>
salt <span class="s1">&#39;tpages.cn&#39;</span> state.apply XXX
salt -N <span class="s1">&#39;alicloud-cn&#39;</span> state.apply XXX  <span class="c1"># match a nodegroup</span>
salt -G <span class="s1">&#39;os@centos&#39;</span> state.apply XXX,YYY <span class="c1"># match with salt grain</span>
<span class="c1"># Salt test before applying to see what changes will be made</span>
salt <span class="s1">&#39;*&#39;</span> state.apply XXX <span class="nv">test</span><span class="o">=</span>True
<span class="c1"># Syn all grains</span>
salt <span class="s1">&#39;*&#39;</span> saltutil.sync_grains
</pre></div>
</div>
</div>
</div>
<div class="section" id="operating-steps">
<span id="operating-steps"></span><h2><strong>Operating Steps</strong><a class="headerlink" href="#operating-steps" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li>Start salt-master in debug mode so that you can check more details happened under the hood.</li>
</ul>
<div class="highlight-shell"><div class="highlight"><pre><span></span>salt-master -l debug
</pre></div>
</div>
<ul class="simple">
<li>Start ssh tunnels.</li>
</ul>
<div class="highlight-shell"><div class="highlight"><pre><span></span>sh dist/tools/scripts/saltmaster-tunnels.sh --start
</pre></div>
</div>
<ul class="simple">
<li>Test salt minions connection status</li>
</ul>
<div class="highlight-shell"><div class="highlight"><pre><span></span>salt <span class="s1">&#39;*&#39;</span> test.ping
</pre></div>
</div>
<ul class="simple">
<li>Draft the state formula in src/master directory.</li>
<li>Build before applying state files.</li>
</ul>
<p>In our build config, we mainly conduct shell scripts syntax check, nginx config test, and salt state files check locally, so that everything are under control before applying to the production environment.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ant</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
<ul class="simple">
<li>Revert changes.</li>
</ul>
<p>If you wanna revert changes in dist directory even if the former build is successful, just run the salt.revert task with ant.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>ant revert
</pre></div>
</div>
<ul class="simple">
<li>Apply the state file to target minion.</li>
</ul>
<div class="highlight-shell"><div class="highlight"><pre><span></span>salt <span class="s1">&#39;tpages.cn&#39;</span> state.apply nginx,repos <span class="nv">saltenv</span><span class="o">=</span>base
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="features">
<span id="features"></span><h2><strong>Features</strong><a class="headerlink" href="#features" title="Permalink to this headline">#</a></h2>
<div class="section" id="nodegroup">
<span id="nodegroup"></span><h3><strong><em>Nodegroup</em></strong><a class="headerlink" href="#nodegroup" title="Permalink to this headline">#</a></h3>
<p>| Nodegroup    | Salt-masters               |Salt-minions      | Minion Address | Notes
|&#8212;&#8212;&#8212;&#8212;&#8211;|&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-|&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;|&#8212;&#8212;&#8212;&#8212;&#8212;-|&#8212;&#8212;-
|alicloud-cn   |10.168.13.25                | www.go1978.com   |                |
|alicloud-cn   |10.168.13.25                | www.123go.net.cn |                |
|alicloud-cn   |10.168.13.25                | tpages.cn        |                |
|alicloud-cn   |10.168.13.25                | app.tpages.cn    |                |
|alicloud-intl |10.45.246.58                | dev.tpages.intl  |                |
|alicloud-intl |10.45.246.58                | tpages.intl      |                |
|local         |192.168.3.167/192.168.3.82/ | homeyard         |                |
|local         |192.168.3.167/192.168.3.82/ | sinospirit       |                |
|local         |192.168.3.167/192.168.3.82/ | itserver         |                |</p>
</div>
<div class="section" id="states">
<span id="states"></span><h3><strong><em>States</em></strong><a class="headerlink" href="#states" title="Permalink to this headline">#</a></h3>
</div>
<div class="section" id="pillar">
<span id="pillar"></span><h3><strong><em>Pillar</em></strong><a class="headerlink" href="#pillar" title="Permalink to this headline">#</a></h3>
</div>
<div class="section" id="grains">
<span id="grains"></span><h3><strong><em>Grains</em></strong><a class="headerlink" href="#grains" title="Permalink to this headline">#</a></h3>
</div>
</div>
<div class="section" id="trouble-shooting">
<span id="trouble-shooting"></span><h2><strong>Trouble Shooting</strong><a class="headerlink" href="#trouble-shooting" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><strong><em>SaltReqTimeoutError on minion side. &amp;&amp; Falied to authenticate message</em></strong></li>
</ul>
<p>This is most likely to happen in the testing phase of a Salt deployment, when all Minion keys have already been accepted, but the framework is being tested and parameters are frequently changed in the Salt Master&#8217;s configuration file(s).</p>
<p>The Salt Master generates a new AES key to encrypt its publications at certain events such as a Master restart or the removal of a Minion key. If you are encountering this problem of too many minions re-authing against the Master, you will need to recalibrate your setup to reduce the rate of events like a Master restart or Minion key removal (salt-key -d).</p>
<p>When the Master generates a new AES key, the minions aren&#8217;t notified of this but will discover it on the next pub job they receive. When the Minion receives such a job it will then re-auth with the Master. Since Salt does minion-side filtering this means that all the minions will re-auth on the next command published on the master&#8211; causing another &#8220;thundering herd&#8221;. This can be avoided by setting the</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">random_reauth_delay</span><span class="p">:</span> <span class="mi">60</span>
</pre></div>
</div>
<p>in the minions configuration file to a higher value and stagger the amount of re-auth attempts. Increasing this value will of course increase the time it takes until all minions are reachable via Salt commands.</p>
<p>And you can also increase master worker threads (default 5), and always restart minion when you restart your master process.</p>
<ul class="simple">
<li><strong><em>ERROR: Minions returned with non-zero exit code</em></strong></li>
</ul>
<p>Delete sudo_user config in minion configuration file.</p>
<ul class="simple">
<li><strong><em>Salt-minion restart loop</em></strong></li>
</ul>
<p>Many causes can lead salt-minion into a restart loop. Remember to use salt-call instead of starting salt-minion in debug mode to locate the reason that the minion is in the loop. With the following command:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>salt-call -c /usr/local/saltstack/minion/etc/salt state.apply -l debug
</pre></div>
</div>
<p>Here we got the error that &#8220;cannot import name PKCS1_OAEP&#8221;, so upgrade our salt dependency, pycrypto to the newest version.</p>
</div>
<hr class="docutils" />
<div class="section" id="todo">
<span id="todo"></span><h2><strong>TODO</strong><a class="headerlink" href="#todo" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li>[X] Deploy saltstack in Alicloud China, Alicloud Sigapore, and Local Servers</li>
<li>[X] Enable users(leon, jc, jerry, nginx, loggie), groups(mgr,nginx) management</li>
<li>[X] Enable system repos (remi, epel), hosts, motd namagement</li>
<li>[X] Enable supervisor, gmond, sshd management</li>
<li>[X] Enable nginx, hhvm, vsftp management</li>
<li>[X] Enable saltstack build procedure(for nginx configs, salt state files) before applying</li>
<li>[X] Enable salt-minion deployment</li>
<li>[X] Enable iptables management</li>
<li>[X] Custom grains deployment (shellshock)</li>
<li>[ ] Enable Php-Fpm management</li>
<li>[ ] Deploy Event and Reactor</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="pytp.html" class="btn btn-neutral" title="wechatrobot" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Leon Lee &lt;lee.leon0519@gmail.com&gt;.
      Last updated on Dec 15, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>